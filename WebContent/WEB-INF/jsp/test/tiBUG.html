
<!DOCTYPE html>
<html lang='zh-cn'>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name="renderer" content="webkit"> 
  <title>点觉CTM::提Bug - 禅道</title>
<script language='Javascript'>var config={"webRoot":"\/","appName":"","cookieLife":30,"requestType":"PATH_INFO","requestFix":"-","moduleVar":"m","methodVar":"f","viewVar":"t","defaultView":"html","themeRoot":"\/theme\/","currentModule":"bug","currentMethod":"create","clientLang":"zh-cn","requiredFields":"title,openedBuild","router":"\/index.php","save":"\u4fdd\u5b58","runMode":"","timeout":30000,"pingInterval":""};
var lang={"submitting":"\u7a0d\u5019...","save":"\u4fdd\u5b58","timeout":"\u8fde\u63a5\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u73af\u5883\uff0c\u6216\u91cd\u8bd5\uff01"};

</script>
<script src='http://cdn.zentao.net/8.2.4/js/all.js?v=8.2.4' type='text/javascript'></script>
<link rel='stylesheet' href='http://cdn.zentao.net/8.2.4/theme/default/zh-cn.default.css?v=8.2.4' type='text/css' media='screen' />
<style>.ke-toolbar .ke-outline[data-name='savetemplate'] {display: none}
#modulemenu .nav #dropMenu #searchResult .closed{text-decoration:none;}
.ke-toolbar .ke-outline[data-name='savetemplate'] {display: block;}
.ke-outline  .ke-icon-savetemplate {background-image: url(theme/default/images/kindeditor/save.gif); background-position: center; width: 56px; height: 20px;}

/* template box */

.bootbox-prompt .modal-dialog {width: 500px; margin-top: 10%;}

#buildBoxActions {padding-left: 15px;}

#tplBoxWrapper {position: relative; z-index: 10;}
#tplBoxWrapper > .btn-toolbar {position: absolute; right: 0px; top: 0px;}
#tplBoxWrapper .btn {padding: 4px 8px}
#tplBox li {position: relative;}
#tplBox li .btn-delete {position: absolute; right: 0; top: 0; display: block; width: 40px; text-align:center;}
#tplBox li .tpl-name {padding-right: 40px;}

#module_chosen.chosen-container .chosen-drop {min-width: 400px; border-top: 1px solid #ddd!important}
#openedBuild_chosen.chosen-container .chosen-drop {min-width: 450px; border-top: 1px solid #ddd!important}
#module + .chosen-container-single .chosen-single,
#task + .chosen-container-single .chosen-single,
#openedBuild + .chosen-container-multi .chosen-choices {border-top-left-radius: 0; border-bottom-left-radius: 0;}
#openedBuild + .chosen-container-multi .chosen-choices,
#mailto + .chosen-container-multi .chosen-choices {border-top-right-radius: 0; border-bottom-right-radius: 0;}

.dropdown-pris > .btn {background-color: #fff; text-shadow: none}

/* Keep label has same width as relative task label*/
#keywordsAddonLabel:before {content: '空'; color: transparent} 

#contactListGroup .input-group-btn > .btn {margin-left: -1px!important;}

.chosen-container {max-width: 533px;}

.minw-80px {min-width: 80px;}

.colorpicker.input-group-btn > .btn {border-right: none}
</style><link rel='icon' href='/favicon.ico' type='image/x-icon' />
<link rel='shortcut icon' href='/favicon.ico' type='image/x-icon' />
<!--[if lt IE 9]>
<script src='http://cdn.zentao.net/8.2.4/js/html5shiv/min.js?v=8.2.4' type='text/javascript'></script>
<script src='http://cdn.zentao.net/8.2.4/js/respond/min.js?v=8.2.4' type='text/javascript'></script>
<![endif]-->
<!--[if lt IE 10]>
<script src='http://cdn.zentao.net/8.2.4/js/jquery/placeholder/min.js?v=8.2.4' type='text/javascript'></script>
<![endif]-->
</head>
<body>
<script>
var noResultsMatch       = '没有匹配结果';
var chooseUsersToMail    = '选择要发信通知的用户...';
var defaultChosenOptions = {no_results_text: noResultsMatch, width:'100%', allow_single_deselect: true, disable_search_threshold: 1, placeholder_text_single: ' ', placeholder_text_multiple: ' ', search_contains: true};
$(document).ready(function()
{
    $("#mailto").attr('data-placeholder', chooseUsersToMail);
    $("#mailto, .chosen, #productID").chosen(defaultChosenOptions).on('chosen:showing_dropdown', function()
    {
        var $this = $(this);
        var $chosen = $this.next('.chosen-container').removeClass('chosen-up');
        var $drop = $chosen.find('.chosen-drop');
        $chosen.toggleClass('chosen-up', $drop.height() + $drop.offset().top - $(document).scrollTop() > $(window).height());
    });
});
</script>
<header id='header'>
  
  <nav id='mainmenu'>
    <ul class='nav'>
<li  data-id='my'><a href='/my/' ><i class="icon-home"></i><span> 我的地盘</span></a></li>
<li  data-id='product'><a href='/product/' >产品</a></li>
<li class='active' data-id='qa'><a href='/qa/' class='active'>测试</a></li>
<li  data-id='project'><a href='/project/' >项目</a></li>
<li  data-id='doc'><a href='/doc/' >文档</a></li>
<li  data-id='report'><a href='/report/' >统计</a></li>
<li  data-id='admin'><a href='/admin/' >后台</a></li>
<li  data-id='company'><a href='/company/' >组织</a></li>
<li class='custom-item'><a href='/custom-ajaxMenu-bug-create.html?onlybody=yes' data-toggle='modal' data-type='iframe' title='自定义导航' data-icon='cog' data-width='80%'><i class='icon icon-cog'></i></a></li></ul>
<div class='input-group input-group-sm' id='searchbox'><div class='input-group-btn' id='typeSelector'><button type='button' class='btn dropdown-toggle' data-toggle='dropdown'><span id='searchTypeName'>Bug</span> <span class='caret'></span></button><input type='hidden' name='searchType' id='searchType' value='bug'  />
<ul class='dropdown-menu'><li><a href='javascript:;' data-value='bug'>Bug</a></li><li><a href='javascript:;' data-value='story'>需求</a></li><li><a href='javascript:;' data-value='task'>任务</a></li><li><a href='javascript:;' data-value='testcase'>用例</a></li><li><a href='javascript:;' data-value='project'>项目</a></li><li><a href='javascript:;' data-value='product'>产品</a></li><li><a href='javascript:;' data-value='user'>用户</a></li><li><a href='javascript:;' data-value='build'>版本</a></li><li><a href='javascript:;' data-value='release'>发布</a></li><li><a href='javascript:;' data-value='productplan'>产品计划</a></li><li><a href='javascript:;' data-value='testtask'>测试版本</a></li><li><a href='javascript:;' data-value='doc'>文档</a></li></ul></div><input type='text' name='searchQuery' id='searchQuery' value='' onclick='this.value=""' onkeydown='if(event.keyCode==13) shortcut()' class='form-control' placeholder='编号(ctrl+g)' />
<div id='objectSwitcher' class='input-group-btn'><a href='javascript:shortcut();' class='btn'>GO! </a></div></div>
  </nav>
  <nav id="modulemenu">
    <ul class='nav'>
<li data-id='product'><a id='currentItem' href="javascript:showDropMenu('product', '21', 'bug', 'browse', '')">点觉CTM <span class='icon-caret-down'></span></a><div id='dropMenu'><i class='icon icon-spin icon-spinner'></i></div></li>
<li class='right ' data-id='index'><a href='/qa-index-no-21.html' ><i class='icon-home'></i>测试主页</a>
</li>
<li class=' active' data-id='bug'><a href='/bug-browse-21.html' >Bug</a>
</li>
<li class=' ' data-id='testcase'><a href='/testcase-browse-21.html' >用例</a>
</li>
<li class=' ' data-id='testtask'><a href='/testtask-browse-21.html' >版本</a>
</li>
</ul>
  </nav>
</header>

<div id='wrap'>
  <div class='outer'>
<script src='http://cdn.zentao.net/8.2.4/js/jquery/form/min.js?v=8.2.4' type='text/javascript'></script>
<script src='http://cdn.zentao.net/8.2.4/js/jquery/form/zentao.js?v=8.2.4' type='text/javascript'></script>
<script language='Javascript'>themeRoot = "http:\/\/cdn.zentao.net\/8.2.4\/theme\/";</script>
<link rel="stylesheet" href="http://cdn.zentao.net/8.2.4/js/kindeditor/themes/default/default.css" />
<script src='http://cdn.zentao.net/8.2.4/js/kindeditor/kindeditor-min.js' type='text/javascript'></script>
<script src='http://cdn.zentao.net/8.2.4/js/kindeditor/lang/zh_CN.js' type='text/javascript'></script>
<script language='javascript'>
var editor = {"id":["steps"],"tools":"bugTools"};

var bugTools =
[ 'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic','underline', '|', 
'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist', 'insertunorderedlist', '|',
'emoticons', 'image', 'code', 'link', '|', 'removeformat','undo', 'redo', 'fullscreen', 'source', 'about'];

var simpleTools = 
[ 'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic','underline', '|', 
'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist', 'insertunorderedlist', '|',
'emoticons', 'image', 'code', 'link', '|', 'removeformat','undo', 'redo', 'fullscreen', 'source', 'about'];

var fullTools = 
[ 'formatblock', 'fontname', 'fontsize', 'lineheight', '|', 'forecolor', 'hilitecolor', '|', 'bold', 'italic','underline', 'strikethrough', '|',
'justifyleft', 'justifycenter', 'justifyright', 'justifyfull', '|',
'insertorderedlist', 'insertunorderedlist', '|',
'emoticons', 'image', 'insertfile', 'hr', '|', 'link', 'unlink', '/',
'undo', 'redo', '|', 'selectall', 'cut', 'copy', 'paste', '|', 'plainpaste', 'wordpaste', '|', 'removeformat', 'clearhtml','quickformat', '|',
'indent', 'outdent', 'subscript', 'superscript', '|',
'table', 'code', '|', 'pagebreak', 'anchor', '|', 
'fullscreen', 'source', 'preview', 'about'];

$(document).ready(initKindeditor);
function initKindeditor(afterInit)
{
    var nextFormControl = 'input:not([type="hidden"]), textarea:not(.ke-edit-textarea), button[type="submit"], select';
    $.each(editor.id, function(key, editorID)
    {
        editorTool = simpleTools;
        if(editor.tools == 'bugTools')  editorTool = bugTools;
        if(editor.tools == 'fullTools') editorTool = fullTools;

        var K = KindEditor, $editor = $('#' + editorID);
        var options = 
        {
            cssPath:[themeRoot + 'zui/css/min.css'],
            width:'100%',
            items:editorTool,
            filterMode: true, 
            bodyClass:'article-content',
            urlType:'relative', 
            uploadJson: createLink('file', 'ajaxUpload'),
            allowFileManager:true,
            langType:'zh_CN',
            afterBlur: function(){this.sync();$editor.prev('.ke-container').removeClass('focus');},
            afterFocus: function(){$editor.prev('.ke-container').addClass('focus');},
            afterChange: function(){$editor.change().hide();},
            afterCreate : function()
            {
                var doc = this.edit.doc; 
                var cmd = this.edit.cmd; 
                if(!K.WEBKIT && !K.GECKO)
                {
                    var pasted = false;
                    $(doc.body).bind('paste', function(ev)
                    {
                        pasted = true;
                        return true;
                    });
                    setTimeout(function()
                    {
                        $(doc.body).bind('keyup', function(ev)
                        {
                            if(pasted)
                            {
                                pasted = false;
                                return true;
                            }
                            if(ev.keyCode == 86 && ev.ctrlKey) alert('您的浏览器不支持粘贴图片！');
                        })
                    }, 10);
                }
                /* Paste in chrome.*/
                /* Code reference from http://www.foliotek.com/devblog/copy-images-from-clipboard-in-javascript/. */
                if(K.WEBKIT)
                {
                    $(doc.body).bind('paste', function(ev)
                    {
                        var $this    = $(this);
                        var original = ev.originalEvent;
                        var file     = original.clipboardData.items[0].getAsFile();
                        if(file)
                        {
                            var reader = new FileReader();
                            reader.onload = function(evt) 
                            {
                                var result = evt.target.result; 
                                var result = evt.target.result;
                                var arr    = result.split(",");
                                var data   = arr[1]; // raw base64
                                var contentType = arr[0].split(";")[0].split(":")[1];

                                html = '<img src="' + result + '" alt="" />';
                                $.post(createLink('file', 'ajaxPasteImage'), {editor: html}, function(data){cmd.inserthtml(data);});
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
                /* Paste in firfox and other firfox.*/
                else
                {
                    K(doc.body).bind('paste', function(ev)
                    {
                        setTimeout(function()
                        {
                            var html = K(doc.body).html();
                            if(html.search(/<img src="data:.+;base64,/) > -1)
                            {
                                K(doc.body).html(html.replace(/<img src="data:.+;base64,.*".*\/>/, ''));
                                $.post(createLink('file', 'ajaxPasteImage'), {editor: html}, function(data){K(doc.body).html(data);});
                            }
                        }, 80);
                    });
                }
                /* End */
            },
            afterTab: function(id)
            {
                var $next = $editor.next(nextFormControl);
                if(!$next.length) $next = $editor.parent().next().find(nextFormControl);
                if(!$next.length) $next = $editor.parent().parent().next().find(nextFormControl);
                $next = $next.first().focus();
                var keditor = $next.data('keditor');
                if(keditor) keditor.focus();
                else if($next.hasClass('chosen')) $next.trigger('chosen:activate');
            }
        };
        try
        {
            if(!window.editor) window.editor = {};
            var keditor = K.create('#' + editorID, options);
            window.editor['#'] = window.editor[editorID] = keditor;
            $editor.data('keditor', keditor);
        }
        catch(e){}
    });

    if($.isFunction(afterInit)) afterInit();
}
</script>
<script language='Javascript'>holders = {"chooseBuilds":"\u9009\u62e9\u76f8\u5173\u7248\u672c..."};</script>
<script language='Javascript'>page = "create";</script>
<script language='Javascript'>createRelease = "\u521b\u5efa\u53d1\u5e03";</script>
<script language='Javascript'>createBuild = "\u521b\u5efa\u7248\u672c";</script>
<script language='Javascript'>refresh = "\u5237\u65b0";</script>
<div class='container mw-1400px'>
  <div id='titlebar'>
    <div class='heading'>
      <span class='prefix'><i class='icon-bug'></i></span>
      <strong><small class='text-muted'><i class='icon-plus'></i></small> 提Bug</strong>
    </div>
    <div class='actions'>
      <button type='button' class='btn btn-default' data-toggle='customModal'><i class='icon icon-cog'></i></button>
    </div>
  </div>
  <form class='form-condensed' method='post' enctype='multipart/form-data' id='dataform' data-type='ajax'>
    <table class='table table-form'> 
      <tr>
        <th class='w-110px'>所属产品</th>
        <td class='w-p45-f'>
          <div class='input-group'>
            <select name='product' id='product' onchange='loadAll(this.value);' class='form-control chosen' autocomplete='off'>
<option value='50'>新IUU</option>
<option value='49'>洱海</option>
<option value='48'>地铁1</option>
<option value='47'>1321313</option>
<option value='46'>新旅游APP</option>
<option value='43'>测试000</option>
<option value='42'>test-多平台</option>
<option value='41'>去恶恶</option>
<option value='39'>qiyu办公</option>
<option value='38'>bugClose</option>
<option value='40'>测试项目</option>
<option value='37'>lingfo</option>
<option value='44'>aa</option>
<option value='36'>北京移动项目</option>
<option value='35'>ccc</option>
<option value='34'>ssss</option>
<option value='33'>世界核平管理器</option>
<option value='45'>IUU</option>
<option value='32'>gsfsd</option>
<option value='31'>车辆管理</option>
<option value='30'>产品测试Demo</option>
<option value='29'>test-yq</option>
<option value='28'>友途车友绘（IOS）</option>
<option value='27'>思道OA</option>
<option value='26'>hehe</option>
<option value='25'>rwebvr</option>
<option value='24'>客户管理</option>
<option value='23'>贸易管理</option>
<option value='22'>资产管理</option>
<option value='21' selected='selected'>点觉CTM</option>
<option value='20'>dfsdf</option>
<option value='19'>test22222</option>
<option value='18'>APP</option>
<option value='15'>产品测试temp</option>
<option value='14'>qq 红包</option>
<option value='13'>EasyTouch</option>
<option value='16'>课外网1</option>
<option value='12'>P2P</option>
<option value='10'>测试产品</option>
<option value='9'>test</option>
<option value='8'>小刀网单接入</option>
<option value='7'>征信平台</option>
<option value='6'>产品Demo</option>
<option value='5'>H5 7月版本</option>
<option value='4'>KGK</option>
<option value='3'>测试</option>
<option value='2'>企业内部工时管理系统</option>
<option value='1'>公司企业网站建设</option>
<option value='17'>电气一次</option>
</select>
                      </div>
        </td>
        <td>
          <div class='input-group' id='moduleIdBox'>
            <span class="input-group-addon">所属模块</span>
            <select name='module' id='module' onchange='loadModuleRelated()' class='form-control chosen'>
<option value='0' selected='selected'>/</option>
</select>
<span class='input-group-addon'><a href='/tree-browse-21-bug-0-0.html'  target='_blank'>维护模块</a>
&nbsp; <a href='javascript:loadProductModules(21)' >刷新</a>
</span>          </div>
        </td>
        <td></td>
      </tr>
            <tr>
        <th>所属项目</th>
                <td><span id='projectIdBox'><select name='project' id='project' class='form-control chosen' onchange='loadProjectRelated(this.value)' autocomplete='off'>
<option value=''></option>
<option value='22'>33332555</option>
</select>
</span></td>
                <td>
          <div class='input-group'>
                        <span class='input-group-addon'>影响版本</span>
                        <span id='buildBox'><select name='openedBuild[]' id='openedBuild' size=4 multiple=multiple class='chosen form-control'>
<option value='trunk'>Trunk</option>
</select>
</span>
            <span class='input-group-addon' id='buildBoxActions'></span>
            <span class='input-group-btn'> <button type='button' class='btn btn-default' class='btn btn-default' data-toggle='tooltip' onclick='loadAllBuilds()' title='所有'><i class="icon icon-filter"></i></button></span>
          </div>
        </td>
      </tr>
      <tr>
        <th><nobr>当前指派</nobr></th>
        <td>
          <div class='input-group'>
            <span id='assignedToBox'><select name='assignedTo' id='assignedTo' class='form-control chosen'>
<option value='' selected='selected'></option>
<option value='admin'>A:admin</option>
<option value='demo'>D:Demo</option>
<option value='dev1'>D:开发甲</option>
<option value='projectManager'>P:项目经理</option>
<option value='tester2'>T:测试乙</option>
</select>
</span>
            <span class='input-group-btn'> <button type='button' class='btn btn-default' class='btn btn-default' onclick='loadAllUsers()' data-toggle='tooltip' title='所有用户'><i class="icon icon-filter"></i></button></span>
          </div>
        </td>
      </tr>
                  <tr>
        <th>Bug类型</th>
        <td>
          <div class='input-group'>
            <select name='type' id='type' class='form-control'>
<option value=''></option>
<option value='codeerror' selected='selected'>代码错误</option>
<option value='interface'>界面优化</option>
<option value='designdefect'>设计缺陷</option>
<option value='config'>配置相关</option>
<option value='install'>安装部署</option>
<option value='security'>安全相关</option>
<option value='performance'>性能问题</option>
<option value='standard'>标准规范</option>
<option value='automation'>测试脚本</option>
<option value='others'>其他</option>
</select>
                        <span class='input-group-addon fix-border'>操作系统</span>
            <select name='os' id='os' class='form-control'>
<option value='' selected='selected'></option>
<option value='all'>全部</option>
<option value='windows'>Windows</option>
<option value='win8'>Windows 8</option>
<option value='win7'>Windows 7</option>
<option value='vista'>Windows Vista</option>
<option value='winxp'>Windows XP</option>
<option value='win2012'>Windows 2012</option>
<option value='win2008'>Windows 2008</option>
<option value='win2003'>Windows 2003</option>
<option value='win2000'>Windows 2000</option>
<option value='android'>Android</option>
<option value='ios'>IOS</option>
<option value='wp8'>WP8</option>
<option value='wp7'>WP7</option>
<option value='symbian'>Symbian</option>
<option value='linux'>Linux</option>
<option value='freebsd'>FreeBSD</option>
<option value='osx'>OS X</option>
<option value='unix'>Unix</option>
<option value='others'>其他</option>
</select>
                                    <span class='input-group-addon fix-border'>浏览器</span>
            <select name='browser' id='browser' class='form-control'>
<option value='' selected='selected'></option>
<option value='all'>全部</option>
<option value='ie'>IE系列</option>
<option value='ie11'>IE11</option>
<option value='ie10'>IE10</option>
<option value='ie9'>IE9</option>
<option value='ie8'>IE8</option>
<option value='ie7'>IE7</option>
<option value='ie6'>IE6</option>
<option value='chrome'>chrome</option>
<option value='firefox'>firefox系列</option>
<option value='firefox4'>firefox4</option>
<option value='firefox3'>firefox3</option>
<option value='firefox2'>firefox2</option>
<option value='opera'>opera系列</option>
<option value='oprea11'>opera11</option>
<option value='oprea10'>opera10</option>
<option value='opera9'>opera9</option>
<option value='safari'>safari</option>
<option value='maxthon'>傲游</option>
<option value='uc'>UC</option>
<option value='other'>其他</option>
</select>
                      </div>
        </td>
      </tr>
      <tr>
        <th>Bug标题</th>
        <td colspan='2'>
          <div class='row-table'>
            <div class='col-table w-p100'>
              <div class='input-group w-p100'>
                <input type='hidden' id='color' name='color' data-provide='colorpicker' data-wrapper='input-group-btn' data-pull-menu-right='false' data-btn-tip='颜色标签' data-update-text='#title'>
                <input type='text' name='title' id='title' value='' class='form-control' />
              </div>
            </div>
                                                            <div class='col-table w-230px'>
              <div class='input-group'>
                                <span class='input-group-addon fix-border br-0'>严重程度</span>
                                                <select name='severity' id='severity' class='form-control minw-80px'>
<option value='3' selected='selected'>一般</option>
<option value='1'>致命</option>
<option value='2'>严重</option>
<option value='4'>普通</option>
<option value='5'>5</option>
<option value='7'>7</option>
<option value='6'>不严重</option>
</select>
 
                                                                <span class='input-group-addon fix-border br-0'>优先级</span>
                                                <select name='pri' id='pri' class='form-control minw-80px'>
<option value='0'></option>
<option value='7'>7</option>
<option value='3'>中</option>
<option value='1'>紧急</option>
<option value='2'>高</option>
<option value='4'>低</option>
<option value='5'>5</option>
<option value='6'>6</option>
</select>
 
                                              </div>
            </div>
                      </div>
        </td>
      </tr>  
      <tr>
        <th>重现步骤</th>
        <td colspan='2'>
          <div id='tplBoxWrapper'>
            <div class='btn-toolbar'>
              <div class='btn-group'>
                <button id='saveTplBtn' type='button' class='btn btn-mini' data-toggle='saveTplModal'>保存模板</button>
                <button type='button' class='btn btn-mini dropdown-toggle' data-toggle='dropdown'>应用模版 <span class='caret'></span></button>
                <ul id='tplBox' class='dropdown-menu pull-right'>
                                  </ul>
              </div>
            </div>
          </div>
          <textarea name='steps' id='steps' rows='5' class='form-control'>&lt;p&gt;[步骤]&lt;/p&gt;
&lt;p&gt;[结果]&lt;/p&gt;
&lt;p&gt;[期望]&lt;/p&gt;</textarea>
        </td>
      </tr>
                  <tr>
        <th>相关需求</th>
                <td>
          <span id='storyIdBox'><select name='story' id='story' class='form-control chosen'>
<option value='0' selected='selected'></option>
</select>
</span>
        </td>
                        <td>
          <div class='input-group'>
                        <span class='input-group-addon'>相关任务</span>
                        <span id='taskIdBox'> <select name='task' id='task' class='form-control chosen'>
<option value='0' selected='selected'></option>
</select>
</span>
          </div>
        </td>
              </tr>
                              <tr>
        <th>抄送给</th>
                <td>
          <div class='input-group' id='contactListGroup'>
          <select name='mailto[]' id='mailto' class='form-control chosen' multiple>
<option value='' selected='selected'></option>
<option value='dev1'>D:开发甲</option>
<option value='dev2'>D:开发乙</option>
<option value='dev3'>D:开发丙</option>
<option value='tester1'>T:测试甲</option>
<option value='tester2'>T:测试乙</option>
<option value='tester3'>T:测试丙</option>
<option value='testManager'>T:测试经理</option>
<option value='projectManager'>P:项目经理</option>
<option value='admin'>A:admin</option>
<option value='demo'>D:Demo</option>
<option value='feedback'>F:Feedback</option>
<option value='productManager'>P:产品经理</option>
</select>
<select name='' id='' class='form-control chosen' onchange="setMailto('mailto', this.value)">
<option value='' selected='selected'>联系人</option>
<option value='4'>zhl</option>
<option value='2'>aa</option>
<option value='5'></option>
</select>
          </div>
        </td>
                        <td >
          <div class='input-group'>
                        <span class='input-group-addon' id='keywordsAddonLabel'>关键词</span>
                        <input type='text' name='keywords' id='keywords' value='' class='form-control' />
          </div>
        </td>
              </tr>
            <tr>
        <th>附件</th>
        <td colspan='2'><span style='color:red'>因为安全原因，Demo暂时不支持上传附件功能！</span></td>
      </tr>
      <tr>
        <td></td>
        <td colspan='2'>
           <button type='submit' id='submit' class='btn btn-primary'  data-loading='稍候...'>保存</button><a href='javascript:history.go(-1);' class='btn btn-back ' >返回</a><input type='hidden' name='case' id='case' value='0'  />
<input type='hidden' name='caseVersion' id='caseVersion' value='0'  />
<input type='hidden' name='result' id='result' value='0'  />
<input type='hidden' name='testtask' id='testtask' value='0'  />
        </td>
      </tr>
    </table>
  </form>
</div>
<div class="modal fade" id="saveTplModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog w-600px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">请输入bug模板标题</h4>
      </div>
      <div class="modal-body">
        <div class='input-group'>
          <input type='text' name='title' id='title' value='' class='form-control' />
                    <span class='input-group-addon'><label class='checkbox-inline'><input type='checkbox' name='public[]' value='1'  id='public1' /> 公共</label></span>
                    <span class='input-group-btn'> <button type='submit' id='submit' class='btn btn-primary'  data-loading='稍候...'>保存</button></span>
        </div>
      </div>
    </div>
  </div>
</div>
<script language='Javascript'>bugModule = "\u6240\u5c5e\u6a21\u5757";</script>
<style>
#customModal .checkbox-inline{width:90px}
#customModal .checkbox-inline+.checkbox-inline{margin-left:0px;}
</style>
<div class="modal fade" id="customModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog w-800px">
    <div class="modal-content">
      <form class='form-condensed' method='post' target='hiddenwin' action='/custom-ajaxSaveCustomFields-bug-custom-createFields.html'>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h4 class="modal-title">
            <i class="icon-cog"></i> 自定义            <div class='pull-right' style='margin-right:15px;'> <button type='submit' id='submit' class='btn btn-primary'  data-loading='稍候...'>保存</button></div>
          </h4>
        </div>
        <div class="modal-body">
          <p><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='project'  checked ='checked' id='fieldsproject' /> 所属项目</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='story'  checked ='checked' id='fieldsstory' /> 相关需求</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='task'  checked ='checked' id='fieldstask' /> 相关任务</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='pri'  checked ='checked' id='fieldspri' /> 优先级</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='severity'  checked ='checked' id='fieldsseverity' /> 严重程度</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='os'  checked ='checked' id='fieldsos' /> 操作系统</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='browser'  checked ='checked' id='fieldsbrowser' /> 浏览器</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='mailto'  checked ='checked' id='fieldsmailto' /> 抄送给</label><label class='checkbox-inline'><input type='checkbox' name='fields[]' value='keywords'  checked ='checked' id='fieldskeywords' /> 关键词</label></p>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
$("button[data-toggle='customModal']").click(function(){$('#customModal').modal('show')});
$(function()
{
    $table = $('.outer form table:first');
    $form = $table.closest('form');
    if($table.width() > $form.width())$form.css('overflow-x', 'auto')
})
</script>
  </div>  <script>setTreeBox()</script>
    
  <div id='divider'></div>
  <iframe frameborder='0' name='hiddenwin' id='hiddenwin' scrolling='no' class='debugwin hidden'></iframe>
</div>


<script>config.onlybody = 'no';</script>
<script language='Javascript'>$(function() 
{
    setModal4List('iframe', 'bugList');

    if(typeof page == 'undefined') page = '';
    if(page == 'create')
    {
        productID  = $('#product').val();
        moduleID   = $('#module').val();
        assignedto = $('#assignedTo').val();
        changeProductConfirmed = true;
        oldStoryID             = 0;
        oldProjectID           = 0;
        oldOpenedBuild         = '';
        oldTaskID              = 0;
        if(!assignedto) setAssignedTo(moduleID, productID);
        notice();
    }

    if(page == 'create' || page == 'edit' || page == 'assignedto' || page == 'confirmbug')
    {
        oldProductID = $('#product').val();
        $("#story, #task, #mailto").chosen(defaultChosenOptions);
    }
});

/**
 * Load all fields.
 * 
 * @param  int $productID 
 * @access public
 * @return void
 */
function loadAll(productID)
{
    if(page == 'create') 
    {
        loadProjectTeamMembers(productID);
        setAssignedTo();
    }

    if(!changeProductConfirmed)
    {
        firstChoice = confirm(confirmChangeProduct);
        changeProductConfirmed = true;    // Only notice the user one time.

        if(!firstChoice)
        {
            $('#product').val(oldProductID);//Revert old product id if confirm is no.
            $('#product').trigger("chosen:updated");
            $('#product').chosen(defaultChosenOptions);
            return true;
        }

        loadAll(productID);
    }
    else
    {
        $('#taskIdBox').innerHTML = '<select id="task"></select>';  // Reset the task.
        $('#task').chosen(defaultChosenOptions);
        loadProductBranches(productID)
        loadProductModules(productID); 
        loadProductProjects(productID); 
        loadProductBuilds(productID);
        loadProductplans(productID);
        loadProductStories(productID);
    }
}

/**
 * Load by branch.
 * 
 * @access public
 * @return void
 */
function loadBranch()
{
    $('#taskIdBox').innerHTML = '<select id="task"></select>';  // Reset the task.
    $('#task').chosen(defaultChosenOptions);
    productID = $('#product').val();
    loadProductModules(productID); 
    loadProductProjects(productID); 
    loadProductBuilds(productID);
    loadProductplans(productID);
    loadProductStories(productID);
}

/**
  *Load all builds of one project or product.
  *
  * @access public
  * @return void
  */
function loadAllBuilds(that)
{
    if(page == 'resolve')
    {
        oldResolvedBuild = $('#resolvedBuild').val() ? $('#resolvedBuild').val() : 0;
        link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=resolvedBuild&build=' + oldResolvedBuild + '&branch=0&index=0&type=all');
        $('#resolvedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
    }
    else
    {
        productID = $('#product').val();
        projectID = $('#project').val();
        if(page == 'edit') buildBox = $(that).parent().prev().filter('span').attr('id');

        if(projectID)
        {
            loadAllProjectBuilds(projectID, productID);
        }
        else
        {
            loadAllProductBuilds(productID);
        }
    }
}

/** 
  * Load all builds of the project.
  *
  * @param  int    $projectID
  * @param  int    $productID
  * @access public
  * @return void
  */
function loadAllProjectBuilds(projectID, productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    if(page == 'create')
    {
        oldOpenedBuild = $('#openedBuild').val() ? $('#openedBuild').val() : 0;
        link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch + '&index=0&needCreate=true&type=all');
        $('#buildBox').load(link, function(){ notice(); $('#openedBuild').chosen(defaultChosenOptions);});
    }
    if(page == 'edit')
    {
        if(buildBox == 'openedBuildBox')
        {
            link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch + '&index=0&needCreate=true&type=all');
            $('#openedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
        }
        if(buildBox == 'resolvedBuildBox')
        {
            link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=resolvedBuild&build=' + oldResolvedBuild + '&branch=0&index=0&needCreate=true&type=all');
            $('#resolvedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
        }
    }
}

/** 
  * Load all builds of the product.
  *
  * @param  int    $productID
  * @access public
  * @return void
  */
function loadAllProductBuilds(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    if(page == 'create') 
    {
        link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch + '&index=0&type=all');
        $('#buildBox').load(link, function(){ notice(); $('#openedBuild').chosen(defaultChosenOptions);});
    }
    if(page == 'edit')
    {
        if(buildBox == 'openedBuildBox')
        {
            link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch + '&index=0&type=all');
            $('#openedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
        }
        if(buildBox == 'resolvedBuildBox')
        {
            link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=resolvedBuild&build=' + oldResolvedBuild + '&branch=0&index=0&type=all');
            $('#resolvedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
        }
    }
}

/**
 * Load product's modules.
 * 
 * @param  int    $productID 
 * @access public
 * @return void
 */
function loadProductModules(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('tree', 'ajaxGetOptionMenu', 'productID=' + productID + '&viewtype=bug&branch=' + branch + '&rootModuleID=0&returnType=html&needManage=true');
    $('#moduleIdBox').load(link, function()
    {
        $(this).find('select').chosen(defaultChosenOptions)
        if(typeof(bugModule) == 'string') $('#moduleIdBox').prepend("<span class='input-group-addon'>" + bugModule + "</span>")
    });
}

/**
 * Load product stories 
 * 
 * @param  int    $productID 
 * @access public
 * @return void
 */
function loadProductStories(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('story', 'ajaxGetProductStories', 'productID=' + productID + '&branch=' + branch + '&moduleId=0&storyID=' + oldStoryID);
    $('#storyIdBox').load(link, function(){$('#story').chosen(defaultChosenOptions);});
}

/**
 * Load projects of product. 
 * 
 * @param  int    $productID 
 * @access public
 * @return void
 */
function loadProductProjects(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('product', 'ajaxGetProjects', 'productID=' + productID + '&projectID=' + oldProjectID + '&branch=' + branch);
    $('#projectIdBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
}

/**
 * Load product plans.
 * 
 * @param  productID $productID 
 * @access public
 * @return void
 */
function loadProductplans(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('productplan', 'ajaxGetProductplans', 'productID=' + productID + '&branch=' + branch);
    $('#planIdBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
}

/**
 * Load product builds. 
 * 
 * @param  productID $productID 
 * @access public
 * @return void
 */
function loadProductBuilds(productID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch);

    if(page == 'create')
    {
        $('#buildBox').load(link, function(){ notice(); $('#openedBuild').chosen(defaultChosenOptions);});
    }
    else
    {
        $('#openedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
        link = createLink('build', 'ajaxGetProductBuilds', 'productID=' + productID + '&varName=resolvedBuild&build=' + oldResolvedBuild + '&branch=' + branch);
        $('#resolvedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
    }
}

/**
 * Load project related bugs and tasks.
 * 
 * @param  int    $projectID 
 * @access public
 * @return void
 */
function loadProjectRelated(projectID)
{
    if(projectID)
    {
        loadProjectTasks(projectID);
        loadProjectStories(projectID);
        loadProjectBuilds(projectID);
        loadAssignedTo(projectID);
    }
    else
    {
        $('#taskIdBox').innerHTML = '<select id="task"></select>';  // Reset the task.
        loadProductStories($('#product').val());
        loadProductBuilds($('#product').val());
    }
}

/**
 * Load project tasks.
 * 
 * @param  projectID $projectID 
 * @access public
 * @return void
 */
function loadProjectTasks(projectID)
{
    link = createLink('task', 'ajaxGetProjectTasks', 'projectID=' + projectID + '&taskID=' + oldTaskID);
    $('#taskIdBox').load(link, function(){$('#task').chosen(defaultChosenOptions);});
}

/**
 * Load project stories.
 * 
 * @param  projectID $projectID 
 * @access public
 * @return void
 */
function loadProjectStories(projectID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('story', 'ajaxGetProjectStories', 'projectID=' + projectID + '&productID=' + $('#product').val() + '&branch=' + branch + '&moduleID=0&storyID=' + oldStoryID);
    $('#storyIdBox').load(link, function(){$('#story').chosen(defaultChosenOptions);});
}

/**
 * Load builds of a project.
 * 
 * @param  int      $projectID 
 * @access public
 * @return void
 */
function loadProjectBuilds(projectID)
{
    branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    productID = $('#product').val();
    if(page == 'create') oldOpenedBuild = $('#openedBuild').val() ? $('#openedBuild').val() : 0;

    if(page == 'create')
    {
        link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + "&branch=" + branch + "&index=0&needCreate=true");
        $('#buildBox').load(link, function(){ notice(); $('#openedBuild').chosen(defaultChosenOptions);});
    }
    else
    {
        link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=openedBuild&build=' + oldOpenedBuild + '&branch=' + branch);
        $('#openedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});

        link = createLink('build', 'ajaxGetProjectBuilds', 'projectID=' + projectID + '&productID=' + productID + '&varName=resolvedBuild&build=' + oldResolvedBuild + '&branch=' + branch);
        $('#resolvedBuildBox').load(link, function(){$(this).find('select').chosen(defaultChosenOptions)});
    }
}

/**
 * Set story field.
 * 
 * @param  moduleID $moduleID 
 * @param  productID $productID 
 * @access public
 * @return void
 */
function setStories(moduleID, productID)
{
    var branch = $('#branch').val();
    if(typeof(branch) == 'undefined') branch = 0;
    link = createLink('story', 'ajaxGetProductStories', 'productID=' + productID + '&branch=' + branch + '&moduleID=' + moduleID);
    $.get(link, function(stories)
    {
        if(!stories) stories = '<select id="story" name="story" class="form-control"></select>';
        $('#story').replaceWith(stories);
        $('#story_chosen').remove();
        $("#story").chosen(defaultChosenOptions);
    });
}

/**
 * Load product branches.
 * 
 * @param  int $productID 
 * @access public
 * @return void
 */
function loadProductBranches(productID)
{
    $('#branch').remove();
    $.get(createLink('branch', 'ajaxGetBranches', "productID=" + productID), function(data)
    {
        if(data)
        {
            $('#product').closest('.input-group').append(data);
            $('#branch').css('width', page == 'create' ? '120px' : '65px');
        }
    })
}

/**
 * Load team members of the project as assignedTo list.
 * 
 * @param  int     $projectID 
 * @access public
 * @return void
 */
function loadAssignedTo(projectID)
{
    link = createLink('bug', 'ajaxLoadAssignedTo', 'projectID=' + projectID + '&selectedUser=' + $('#assignedTo').val());
    $('#assignedToBox').load(link, function(){$('#assignedTo').chosen(defaultChosenOptions);});
}

/**
 * notice for create build.
 * 
 * @access public
 * @return void
 */
function notice()
{
    $('#buildBoxActions').empty().hide();
    if($('#openedBuild').find('option').length <= 1) 
    {
        var html = '';
        if($('#project').val() == '')
        {
            branch = $('#branch').val();
            if(typeof(branch) == 'undefined') branch = 0;
            html += '<a href="' + createLink('release', 'create', 'productID=' + $('#product').val() + '&branch=' + branch) + '" target="_blank" style="padding-right:5px">' + createRelease + '</a> ';
            html += '<a href="javascript:loadProductBuilds(' + $('#product').val() + ')">' + refresh + '</a>';
        }
        else
        {
            html += '<a href="' + createLink('build', 'create','projectID=' + $('#project').val()) + '" target="_blank" style="padding-right:5px">' + createBuild + '</a> ';
            html += '<a href="javascript:loadProjectBuilds(' + $('#project').val() + ')">' + refresh + '</a>';
        }
        var $bba = $('#buildBoxActions');
        if($bba.length)
        {
            $bba.html(html);
            $bba.show();
        }
        else
        {
            if($('#buildBox').closest('tr').find('td').size() > 1)
            {
                $('#buildBox').closest('td').next().attr('id', 'buildBoxActions');
                $('#buildBox').closest('td').next().html(html);
            }
            else
            {
                html = "<td id='buildBoxActions'>" + html + '</td>';
                $('#buildBox').closest('td').after(html);
            }
        }
    }
}
/**
  * Load all users as assignedTo list.
  *
  * @access public
  * @return void
  */
function loadAllUsers()
{
    link = createLink('bug', 'ajaxLoadAllUsers', 'selectedUser=' + $('#assignedTo').val());
    $('#assignedToBox').load(link, function(){$('#assignedTo').chosen(defaultChosenOptions);});
}

/**
  * Load team members of the latest project of a product as assignedTo list.
  *
  * @param  $productID
  * @access public
  * @return void
  */
function loadProjectTeamMembers(productID)
{
    link = createLink('bug', 'ajaxLoadProjectTeamMembers', 'productID=' + productID + '&selectedUser=' + $('#assignedTo').val());
    $('#assignedToBox').load(link, function(){$('#assignedTo').chosen(defaultChosenOptions);});
}

/**
 * load assignedTo and stories of module.
 * 
 * @access public
 * @return void
 */
function loadModuleRelated()
{
    moduleID  = $('#module').val();
    productID = $('#product').val();
    setAssignedTo(moduleID, productID);
    setStories(moduleID, productID);
}

/**
 * Set the assignedTo field.
 * 
 * @access public
 * @return void
 */
function setAssignedTo(moduleID, productID)
{
    if(typeof(productID) == 'undefined') productID = $('#product').val();
    if(typeof(moduleID) == 'undefined')  moduleID  = $('#module').val();
    link = createLink('bug', 'ajaxGetModuleOwner', 'moduleID=' + moduleID + '&productID=' + productID);
    $.get(link, function(owner)
    {
        $('#assignedTo').val(owner);
        $("#assignedTo").trigger("chosen:updated");
    });
}

/* Set template. */
function setTemplate(templateID)
{
    $('#tplBox .list-group-item.active').removeClass('active');
    $('#tplTitleBox' + templateID).closest('.list-group-item').addClass('active');
    steps = $('#template' + templateID).html();
    editor['#'].html(steps);
}

/* Delete template. */
function deleteTemplate(templateID)
{
    if(!templateID) return;
    hiddenwin.location.href = createLink('bug', 'deleteTemplate', 'templateID=' + templateID);
    $('#tplBox' + templateID).addClass('hidden');
}

$(function()
{
    if($('#project').val()) loadProjectRelated($('#project').val());
    $('#saveTplModal').on('hide.zui.modal', function(){$(this).find('#title').val('');});
    $('#saveTplBtn').click(function(){$('#saveTplModal').modal('show');});
    $('#saveTplModal #submit').click(function()
    {
        var $inputGroup = $('#saveTplModal div.input-group');
        var $publicBox  = $inputGroup.find('input[id^="public"]');
        var title       = $inputGroup.find('#title').val();
        var content     = $('#steps').val();
        var isPublic    = ($publicBox.size() > 0 && $publicBox.prop('checked')) ? $publicBox.val() : 0;
        if(!title || !content) return;
        saveTemplateLink = createLink('bug', 'saveTemplate');
        $.post(saveTemplateLink, {title:title, content:content, public:isPublic}, function(data)
        {
            $('#tplBox').html(data);
            // If has error then not hide.
            if(data.indexOf('alert') == -1) $('#saveTplModal').modal('hide');
        });
    });

    $('[data-toggle=tooltip]').tooltip();

    // ajust style for file box
    var ajustFilebox = function()
    {
        applyCssStyle('.fileBox > tbody > tr > td:first-child {transition: none; width: ' + ($('#contactListGroup').width() - 2) + 'px}', 'filebox')
    };
    ajustFilebox();
    $(window).resize(ajustFilebox);
});

</script>
<div class='hidden'><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_4553360'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/stat.php%3Fid%3D4553360' type='text/javascript'%3E%3C/script%3E"));</script></div>
</body>
</html>
